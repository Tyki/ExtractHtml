function DOMNodeDivision(DOMNode,nLevel,pool){if(filter(DOMNode)){annotation(DOMNode,"noeudfiltré1");return -1}if(!isHr(DOMNode)&& !existChild(DOMNode,isValidNode)){if(DOMNode.nodeName!="IMG"&&DOMNode.nodeName!="INPUT"&&DOMNode.nodeName!="A"&&DOMNode.nodeName!="IFRAME"){annotation(DOMNode,"noeudfiltré-2");return -1}}if(isElementFromPlugin(DOMNode)){annotation(DOMNode,"noeudfiltré-ter");return -1}if(isVirtualContentNode(DOMNode)){annotation(DOMNode,"VISUAL_STRUCTURE NOEUD-ATOMIC-VIRTUEL doc-10");createBasicObjectProperties(DOMNode);setBasicObjectProperties(DOMNode);setBasicObjectType(DOMNode);pool.push(DOMNode);return -1}if(divisible(DOMNode,nLevel)==true){var child=DOMNode.firstChild;while(child){if(!filter(child)){DOMNodeDivision(child,nLevel+1,pool)}child=child.nextSibling}}else{if(isVisible(DOMNode)){pool.push(DOMNode)}}}function divisible(DOMNode,nLevel){var relativeSize=getSize(DOMNode)*100/pageSize;annotation(DOMNode,"tr-"+relativeSize);annotation(DOMNode,"ta-"+getSize(DOMNode));if(getDOC(DOMNode)!="doc-NA")return true;if(hasOnlyOneChild(DOMNode,isValidNode)){annotation(DOMNode,"DIVISION RULE2");return true}if(forAllChildren(DOMNode,isContentNode)||forAllChildren(DOMNode,isVirtualContentNode)){if(!isValidTextNode(DOMNode)){annotation(DOMNode,"VISUAL_STRUCTURE RULE3");annotation(DOMNode," doc-9");createCompositeObjectProperties(DOMNode)}return false}if(!forAllChildren(DOMNode,isInline)&&existChild(DOMNode,isSupRule4Treshold)){annotation(DOMNode,"DIVISION RULE4");return true}var firstChild=getFirstValidChild(DOMNode);if(firstChild!=""&&isTitleElement(firstChild)){var doc="doc-"+processDoc(DOMNode);annotation(DOMNode,"VISUAL_STRUCTURE RULE7");annotation(DOMNode,doc);createCompositeObjectProperties(DOMNode);return false}if(existChild(DOMNode,isHr)){var children=DOMNode.childNodes;var nbChildren=children.length;for(var i=0;i<nbChildren;i++){if(children[i].nodeName=="HR"){var pred=previousValidSibling(children[i]);if(pred){annotation(pred,"visualStruct-"+nLevel+" RULE5 pred");annotation(pred,"doc-3")}createCompositeObjectProperties(pred);var succ=nextValidSibling(fils[i]);if(succ){annotation(succ,"visualStruct-"+nLevel+" RULE5 succ");annotation(succ,"doc-3")}createCompositeObjectProperties(succ)}}return true}if(isChildrenSurfaceSup(DOMNode)){var doc="doc-"+processDoc(DOMNode);annotation(DOMNode,"VISUAL_STRUCTURE RULE6"+doc);createCompositeObjectProperties(DOMNode);return false}var parent=DOMNode.parentNode;if(visualDistance(DOMNode,parent)){var doc="doc-"+processDoc(DOMNode);annotation(DOMNode,"VISUAL_STRUCTURE RULE8 "+doc);createCompositeObjectProperties(DOMNode);return false}if((getSize(biggestChild(DOMNode))*100/pageSize)<rule9Treshold){var doc="doc-"+processDoc(DOMNode);annotation(DOMNode,"VISUAL_STRUCTURE RULE9 "+doc);createCompositeObjectProperties(DOMNode);return false}annotation(DOMNode,"DIVISION NORULE");return true;}function previousValidSibling(DOMNode){while(DOMNode.previousSibling){if(!filter(DOMNode.previousSibling))return DOMNode.previousSibling;DOMNode=DOMNode.previousSibling}return false}function nextValidSibling(DOMNode){while(DOMNode.nextSibling){if(!filter(DOMNode.nextSibling))return DOMNode.nextSibling;DOMNode=DOMNode.nextSibling}return false}function processDoc(DOMNode){var retour=0;if(tagSize[DOMNode.nodeName])retour=tagSize[DOMNode.nodeName];return retour}function visualDistance(DOMNode1,DOMNode2){if($(DOMNode1).css("background-image")!=$(DOMNode2).css("background-image")||$(DOMNode1).css("background-color")!=$(DOMNode2).css("background-color")){return true}if($(DOMNode1).css("border-style")!=$(DOMNode2).css("border-style")||$(DOMNode1).css("border-bottom")!=$(DOMNode2).css("border-bottom")||$(DOMNode1).css("border-bottom-color")!=$(DOMNode2).css("border-bottom-color")||$(DOMNode1).css("border-bottom-width")!=$(DOMNode2).css("border-bottom-width")||$(DOMNode1).css("border-bottom-style")!=$(DOMNode2).css("border-bottom-style")||$(DOMNode1).css("border-top")!=$(DOMNode2).css("border-top")||$(DOMNode1).css("border-top-color")!=$(DOMNode2).css("border-top-color")||$(DOMNode1).css("border-top-width")!=$(DOMNode2).css("border-top-width")||$(DOMNode1).css("border-top-style")!=$(DOMNode2).css("border-top-style")){return true}}function compareTreshold(DOMNode){if(!isValidNode(DOMNode))return false;var relativeT=getSize(DOMNode)*100/pageSize;if(relativeSizeTreshold<relativeT){return true}return false}function biggestChild(DOMNode){var maxChild=DOMNode.firstChild;var child=DOMNode.firstChild;while(child){if(!filter(child)){if(getSize(child)>getSize(maxChild)){maxChild=child}}child=child.nextSibling}return maxChild}function isSumChildrenSup(DOMNode){var sumChild=0;var relativeT=getSize(DOMNode)*100/pageSize;var child=DOMNode.firstChild;while(child){if(!filter(child)){if(tagSize[child.nodeName]){sumChild=sumChild+tagSize[child.nodeName]}}child=child.nextSibling}annotation(DOMNode,"sNoeud-"+sumChild);if(relativeT>sumChild)return true;return false}function isChildrenSurfaceSup(DOMNode){var sumChild=0;var child=DOMNode.firstChild;while(child){if(!filter(child)&&isElement(child)&& !isImg(child)){sumChild=sumChild+getNodeSurface(child)}child=child.nextSibling}annotation(DOMNode,"surfNoeud-"+getNodeSurface(DOMNode));annotation(DOMNode,"surfNoeudEnf-"+sumChild);if(sumChild>getNodeSurface(DOMNode)*1.01)return true;return false}function getNodeSurface(DOMNode){var elementNode=$(DOMNode);var width=elementNode.width();var height=elementNode.height();annotation(DOMNode,"surfNoeud-"+(width*height));return width*height}function countContentChildren(DOMNode){var compteur=0;var fils=DOMNode.childNodes;var nbFils=fils.length;if(nbFils==0){return 0}for(var i=0;i<nbFils;i++){if(isContentNode(fils[i])){compteur=compteur+1}}return compteur}function countValidChildren(DOMNode){var count=0;var children=DOMNode.childNodes;var childrenNb=children.length;if(childrenNb==0){return 0}for(var i=0;i<childrenNb;i++){if(isValidNode(children[i])){count=count+1}}return count}function getFirstValidChild(DOMNode){var child=DOMNode.firstChild;while(child){if(!filter(child)){return child}child=child.nextSibling}return ""}function isNbContentChildrenSup(DOMNode){var nbContentChildren=countContentChildren(DOMNode);var nbNonContentChildren=DOMNode.childNodes.length-nbContentChildren;return(nbContentChildren>=nbNonContentChildren)}function getSize(DOMNode){var count=0;var fils=DOMNode.childNodes;var nbFils=fils.length;if(nbFils==0){if(DOMNode.nodeType==3&&isValidTextNode(DOMNode)){return(DOMNode.textContent.length*3);}return 0}for(var i=0;i<nbFils;i++){if(tagSize[DOMNode.nodeName]){count=count+tagSize[DOMNode.nodeName]+getSize(fils[i])}else{count=count+getSize(fils[i])}}return count}function printNode(DOMNode){var id="N/A";if(!isValidTextNode(DOMNode))id=DOMNode.getAttribute("id");return "type : "+DOMNode.nodeType+" - tag : "+DOMNode.nodeName+" id : "+id+"classe : "+DOMNode.className}function annotation(DOMNode,value){DOMNode.className=DOMNode.className+" "+value}function getDOC(DOMNode){var ret="";var annotString=DOMNode.className;annotString=annotString.split(" ");for(var key in annotString){if(annotString[key].match("doc-*"))return annotString[key];}return "doc-NA"}function getDOCValue(DOMNode){var ret="";var annotString=DOMNode.className;annotString=annotString.split(" ");for(var key in annotString){if(annotString[key].match("doc-*")){ret=annotString[key].split("-")[1];return ret}}return "doc-NA"}function getID(DOMNode){var retour="";var annotString=DOMNode.className;annotString=annotString.split(" ");for(var key in annotString){if(annotString[key].match("id-*"))return annotString[key];}return "id-NA"}function getRelativeSize(DOMNode){var ret="0";var annotString=DOMNode.className;annotString=annotString.split(" ");for(var key in annotString){if(annotString[key].match("tr-*")){ret=annotString[key].split("-")[1]}}return retour}function isElementFromPlugin(DOMNode){var nodeID=DOMNode.getAttribute("id");if(nodeID!=null){if(nodeID.match(/ter__/)!=null)return true;}return false}function createBasicObjectProperties(DOMNode){DOMNode.setAttribute("presentation_media","text");DOMNode.setAttribute("presentation_textlength","0");DOMNode.setAttribute("semanteme","unknown");DOMNode.setAttribute("hyperlink","none");DOMNode.setAttribute("decoration","0");DOMNode.setAttribute("interaction","display");DOMNode.setAttribute("ter_supertype","bo");DOMNode.setAttribute("ter_type","unknown_bo")}function createCompositeObjectProperties(DOMNode){DOMNode.setAttribute("clustering","");DOMNode.setAttribute("root_children_nb","0");DOMNode.setAttribute("ter_supertype","co");DOMNode.setAttribute("ter_type","unknown_co");DOMNode.setAttribute("ter_semantic","unknown")}function setBasicObjectProperties(DOMNode){if(DOMNode.nodeName.match(/H[0-9]/)){DOMNode.setAttribute("semanteme","title")}if(DOMNode.nodeName=="SELECT"){DOMNode.setAttribute("interaction","button")}else if(DOMNode.nodeName=="INPUT"){DOMNode.setAttribute("interaction","unknown");var AttrType=DOMNode.getAttribute("type");if((AttrType=="button")||(AttrType=="checkbox")||(AttrType=="radio")||(AttrType=="search")||(AttrType=="submit")){DOMNode.setAttribute("interaction","button")}else{if((AttrType=="color")||(AttrType=="text")||(AttrType=="password")||(AttrType=="url")||(AttrType=="email")||(AttrType=="tel")||(AttrType=="search")){DOMNode.setAttribute("interaction","input")}}}else if(DOMNode.nodeName=="BUTTON"){DOMNode.setAttribute("interaction","button")}else if(DOMNode.nodeName=="A"){DOMNode.setAttribute("hyperlink","unknown");if(DOMNode.hostname!=location.hostname){DOMNode.setAttribute("hyperlink","extern")}else{DOMNode.setAttribute("hyperlink","intern")}}else{var child=getFirstValidChild(DOMNode);while(child){var textLength=child.textContent.length;var sum=textLength+parseInt(DOMNode.getAttribute("presentation_textlength"));DOMNode.setAttribute("presentation_textlength",sum.toString());if(child.nodeName=="IMG")DOMNode.setAttribute("presentation_media","img");else{grandChild=getFirstValidChild(child);while(grandChild){if(grandChild.nodeName=="IMG"){DOMNode.setAttribute("presentation_media","img")}grandChild=nextValidSibling(grandChild)}}if(child.nodeName=="A"){DOMNode.setAttribute("hyperlink","unknown");if(child.hostname!=location.hostname){DOMNode.setAttribute("hyperlink","extern")}else{DOMNode.setAttribute("hyperlink","intern")}}else{if(child.nodeName=="INPUT"){DOMNode.setAttribute("interaction","unknown");var AttrType=child.getAttribute("type");if((AttrType=="button")||(AttrType=="checkbox")||(AttrType=="radio")||(AttrType=="search")||(AttrType=="submit")){DOMNode.setAttribute("interaction","button")}else{if((AttrType=="color")||(AttrType=="text")||(AttrType=="password")||(AttrType=="url")||(AttrType=="email")||(AttrType=="tel")||(AttrType=="search")){DOMNode.setAttribute("interaction","input")}}}}child=nextValidSibling(child)}}}function setBasicObjectType(DOMNode){if(DOMNode.getAttribute("hyperlink")!="none"){if(DOMNode.getAttribute("hyperlink")=="extern"){DOMNode.setAttribute("ter_type","external_navigation")}else{if(DOMNode.getAttribute("presentation_media")!="img"){DOMNode.setAttribute("ter_type","internal_navigation")}else{DOMNode.setAttribute("ter_type","special_navigation")}}}else{if(((parseInt(DOMNode.getAttribute("presentation_textlength"))>textLengthTreshold)||(DOMNode.getAttribute("presentation_media")=="img"))&&(DOMNode.getAttribute("interaction")=="display")){DOMNode.setAttribute("ter_type","information")}else{if(DOMNode.getAttribute("interaction")!="display"){DOMNode.setAttribute("ter_type","special_control")}else{DOMNode.setAttribute("ter_type","information")}}}}function processAllCO(VSNode){if((VSNode.getAttribute("ter_supertype")=="co")||(VSNode.id==root.id)){var children=VSNode.childNodes;var childrenNb=children.length;for(var i=0;i<childrenNb;i++){if(children[i].getAttribute("ter_supertype")=="co"){processAllCO(children[i])}}if(VSNode.id!=root.id){setCOProperties(VSNode);setCOtype(VSNode)}}}function setCOProperties(VSNode){var rootChildrenCount=0;childrenTypesCount=new Map();child=VSNode.firstChild;while(child){if(child.nodeName.match(/H[0-9]/)==null)rootChildrenCount++;var childType=child.getAttribute("ter_type");if(childType.match("navigation")!=null)childType="navigation";if(!childrenTypesCount.has(childType)){childrenTypesCount.set(childType,0)}if(child.getAttribute("ter_supertype")=="bo"){childrenTypesCount.set(childType,childrenTypesCount.get(childType)+1)}else {childrenTypesCount.set(childType,(childrenTypesCount.get(childType)+parseInt(child.getAttribute("root_children_nb"))));rootChildrenCount=rootChildrenCount+parseInt(child.getAttribute("root_children_nb"))-1}child=child.nextSibling}VSNode.setAttribute("root_children_nb",String(rootChildrenCount));getAssociatedDOMNode(VSNode).setAttribute("root_children_nb",String(rootChildrenCount));maxTypeCount=0;maxType="";for(var[key,value]of childrenTypesCount.entries()){if(maxTypeCount<value){maxTypeCount=value;maxType=key}}if(((maxTypeCount/rootChildrenCount)>0.7)&&(childrenTypesCount.size<3)&&(maxType!="unknown_co")&&(areChildrenPositionsRegular(VSNode))){VSNode.setAttribute("clustering","parallel");getAssociatedDOMNode(VSNode).setAttribute("clustering","parallel");VSNode.setAttribute("ter_type",maxType);getAssociatedDOMNode(VSNode).setAttribute("ter_type",maxType)}else{VSNode.setAttribute("clustering","complement");getAssociatedDOMNode(VSNode).setAttribute("clustering","complement")}}function setCOtype(VSNode){if(VSNode.getAttribute("clustering")=="parallel"){if(VSNode.getAttribute("ter_type")=="navigation"){position=getPositionNode(VSNode);if(position=="Left"){changeChildrenSemantic(VSNode,"MainMenu");VSNode.setAttribute("ter_semantic","MainMenu");getAssociatedDOMNode(VSNode).setAttribute("ter_semantic","MainMenu")}else if(position=="Right"){changeChildrenSemantic(VSNode,"SecMenu");VSNode.setAttribute("ter_semantic","SecMenu");getAssociatedDOMNode(VSNode).setAttribute("ter_semantic","SecMenu")}else if(position=="Top"){if(isHorizontal(VSNode)){VSNode.setAttribute("ter_semantic","Arianne");getAssociatedDOMNode(VSNode).setAttribute("ter_semantic","Arianne")}}else if(position=="Bot"){changeChildrenSemantic(VSNode,"ReferenceList");VSNode.setAttribute("ter_semantic","ReferenceList");getAssociatedDOMNode(VSNode).setAttribute("ter_semantic","ReferenceList")}}}}function setRemainingSemantics(VSNode){child=VSNode.firstChild;while(child){if(child.getAttribute("ter_supertype")=="co"){if(child.getAttribute("ter_semantic")=="unknown"){if(getPositionNode(child)=="Top"){child.setAttribute("ter_semantic","Header");getAssociatedDOMNode(child).setAttribute("ter_semantic","Header")}else if(getPositionNode(child)=="Bot"){child.setAttribute("ter_semantic","Footer");getAssociatedDOMNode(child).setAttribute("ter_semantic","Footer")}else{child.setAttribute("ter_semantic","Content");getAssociatedDOMNode(child).setAttribute("ter_semantic","Content")}}}child=child.nextSibling}}function getAssociatedDOMNode(VSNode){return(document.getElementsByClassName(VSNode.id)[0])}function areChildrenPositionsRegular(VSNode){child=VSNode.firstChild;xCoord=getAssociatedDOMNode(child).offsetLeft;yCoord=getAssociatedDOMNode(child).offsetTop;testEqual="z";child=child.nextSibling;if(child){while(child){DOMchild=getAssociatedDOMNode(child);if((DOMchild.offsetTop>=(yCoord-5))&&(DOMchild.offsetTop<=(yCoord+5))){if(testEqual=="z"){testEqual="y"}}else if(testEqual=="y")return false;if((DOMchild.offsetLeft>=(xCoord-5))&&(DOMchild.offsetLeft<=(xCoord+5))){if(testEqual=="z"){testEqual="x"}}else if(testEqual=="x")return false;child=child.nextSibling}return true}return false}function changeChildrenSemantic(VSNode,s){child=VSNode.firstChild;count=0;while(child){if(child.getAttribute("ter_supertype")=="co"){if(child.getAttribute("ter_semantic")==s){count++;child.setAttribute("ter_semantic",(s+"_part"));getAssociatedDOMNode(child).setAttribute("ter_semantic",(s+"_part-"+count));}}child=child.nextSibling}}function isHorizontal(VSNode){child=VSNode.firstChild;yCoord=getAssociatedDOMNode(child).offsetTop;while(child){DOMChild=getAssociatedDOMNode(child);if((DOMChild.offsetTop>=(yCoord-5))&&(DOMChild.offsetTop<=(yCoord+5))){}else{return false}child=child.nextSibling}return true}function getPositionNode(VSNode){var assoc=getAssociatedDOMNode(VSNode);var jQassoc=$(assoc);var offset=$(assoc).offset();var height=$(assoc).height();var width=$(assoc).width();if(offset.top+height<ratioTop){return "Top"}else if(offset.left+width<ratioLeft){return "Left"}else if(offset.left>ratioRight){return "Right"}else if(offset.top>ratioBottom){return "Bot"}else{return null}return null;}function setupRatio(){var heightPage=document.body.scrollHeight;var widthPage=document.body.scrollWidth;ratioTop=heightPage*15/100;ratioBottom=heightPage*85/100;ratioLeft=widthPage*25/100;ratioRight=widthPage*75/100}